/*
 * File:        dataTables.scroller.min.js
 * Version:     1.1.0
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * Info:        www.datatables.net
 * 
 * Copyright 2008-2012 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD style license, available at:
 *   http://datatables.net/license_gpl2
 *   http://datatables.net/license_bsd
 * 
 * This source file is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 */
/*
     GPL v2 or BSD 3 point style
*/
(function(c,i,h){var f=function(a,b){if(!this instanceof f)alert("Scroller warning: Scroller must be initialised with the 'new' keyword.");else{if(typeof b=="undefined")b={};this.s={dt:a,tableTop:0,tableBottom:0,redrawTop:0,redrawBottom:0,rowHeight:null,autoHeight:true,viewportHeight:0,viewportRows:0,stateTO:null,drawTO:null};this.s=c.extend(this.s,f.oDefaults,b);this.dom={force:h.createElement("div"),scroller:null,table:null};this.s.dt.oScroller=this;this._fnConstruct()}};f.prototype={fnRowToPixels:function(a){return a*
this.s.rowHeight},fnPixelsToRow:function(a){return parseInt(a/this.s.rowHeight,10)},fnScrollToRow:function(a,b){a=this.fnRowToPixels(a);typeof b=="undefined"||b?c(this.dom.scroller).animate({scrollTop:a}):c(this.dom.scroller).scrollTop(a)},fnMeasure:function(a){this.s.autoHeight&&this._fnCalcRowHeight();this.s.viewportHeight=c(this.dom.scroller).height();this.s.viewportRows=parseInt(this.s.viewportHeight/this.s.rowHeight,10)+1;this.s.dt._iDisplayLength=this.s.viewportRows*this.s.displayBuffer;this.s.trace&&
console.log("Row height: "+this.s.rowHeight+" Viewport height: "+this.s.viewportHeight+" Viewport rows: "+this.s.viewportRows+" Display rows: "+this.s.dt._iDisplayLength);if(typeof a=="undefined"||a)this.s.dt.oInstance.fnDraw()},_fnConstruct:function(){var a=this;this.dom.force.style.position="absolute";this.dom.force.style.top="0px";this.dom.force.style.left="0px";this.dom.force.style.width="1px";this.dom.scroller=c("div."+this.s.dt.oClasses.sScrollBody,this.s.dt.nTableWrapper)[0];this.dom.scroller.appendChild(this.dom.force);
this.dom.scroller.style.position="relative";this.dom.table=c(">table",this.dom.scroller)[0];this.dom.table.style.position="absolute";this.dom.table.style.top="0px";this.dom.table.style.left="0px";c(this.s.dt.nTableWrapper).addClass("DTS");this.s.loadingIndicator&&c(this.dom.scroller.parentNode).css("position","relative").append('<div class="DTS_Loading">'+this.s.dt.oLanguage.sLoadingRecords+"</div>");if(this.s.rowHeight&&this.s.rowHeight!="auto")this.s.autoHeight=false;this.fnMeasure(false);c(this.dom.scroller).scroll(function(){a._fnScroll.call(a)});
c(this.dom.scroller).bind("touchstart",function(){a._fnScroll.call(a)});this.s.dt.aoDrawCallback.push({fn:function(){a.s.dt.bInitialised&&a._fnDrawCallback.call(a)},sName:"Scroller"});this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(b,d){d.iScroller=a.dom.scroller.scrollTop},"Scroller_State")},_fnScroll:function(){var a=this,b=this.dom.scroller.scrollTop,d;if(!(this.s.dt.bFiltered||this.s.dt.bSorted)){this.s.trace&&console.log("Scroll: "+b+"px - boundaries: "+this.s.redrawTop+
" / "+this.s.redrawBottom+".  Showing rows "+this.fnPixelsToRow(b)+" to "+this.fnPixelsToRow(b+c(this.dom.scroller).height())+" in the viewport, with rows "+this.s.dt._iDisplayStart+" to "+this.s.dt._iDisplayEnd+" rendered by the DataTable");this._fnInfo();clearTimeout(this.s.stateTO);this.s.stateTO=setTimeout(function(){a.s.dt.oApi._fnSaveState(a.s.dt)},250);if(b<this.s.redrawTop||b>this.s.redrawBottom){var e=(this.s.displayBuffer-1)/2*this.s.viewportRows;d=parseInt(b/this.s.rowHeight,10)-e;if(d<
0)d=0;else if(d+this.s.dt._iDisplayLength>this.s.dt.fnRecordsDisplay()){d=this.s.dt.fnRecordsDisplay()-this.s.dt._iDisplayLength;if(d<0)d=0}else d%2!==0&&d++;if(d!=this.s.dt._iDisplayStart){this.s.tableTop=c(this.s.dt.nTable).offset().top;this.s.tableBottom=c(this.s.dt.nTable).height()+this.s.tableTop;if(this.s.dt.oFeatures.bServerSide){clearTimeout(this.s.drawTO);this.s.drawTO=setTimeout(function(){a.s.dt._iDisplayStart=d;a.s.dt.oApi._fnCalculateEnd(a.s.dt);a.s.dt.oApi._fnDraw(a.s.dt)},this.s.serverWait)}else{this.s.dt._iDisplayStart=
d;this.s.dt.oApi._fnCalculateEnd(this.s.dt);this.s.dt.oApi._fnDraw(this.s.dt)}this.s.trace&&console.log("Scroll forcing redraw - top DT render row: "+d)}}}},_fnDrawCallback:function(){var a=this,b=this.dom.scroller.scrollTop,d=b+this.s.viewportHeight;this.dom.force.style.height=this.s.rowHeight*this.s.dt.fnRecordsDisplay()+"px";var e=this.s.rowHeight*this.s.dt._iDisplayStart;if(this.s.dt._iDisplayStart===0)e=0;else if(this.s.dt._iDisplayStart===this.s.dt.fnRecordsDisplay()-this.s.dt._iDisplayLength)e=
this.s.rowHeight*this.s.dt._iDisplayStart;this.dom.table.style.top=e+"px";this.s.tableTop=e;this.s.tableBottom=c(this.s.dt.nTable).height()+this.s.tableTop;this.s.redrawTop=b-(b-this.s.tableTop)*this.s.boundaryScale;this.s.redrawBottom=b+(this.s.tableBottom-d)*this.s.boundaryScale;this.s.trace&&console.log("Table redraw. Table top: "+e+"px Table bottom: "+this.s.tableBottom+" Scroll boundary top: "+this.s.redrawTop+" Scroll boundary bottom: "+this.s.redrawBottom+" Rows drawn: "+this.s.dt._iDisplayLength);
setTimeout(function(){a._fnInfo.call(a)},0);if(this.s.dt.oFeatures.bStateSave&&this.s.dt.oLoadedState!==null&&typeof this.s.dt.oLoadedState.iScroller!="undefined")if(this.s.dt.sAjaxSource!==null&&this.s.dt.iDraw==2||this.s.dt.sAjaxSource===null&&this.s.dt.iDraw==1)setTimeout(function(){c(a.dom.scroller).scrollTop(a.s.dt.oLoadedState.iScroller);a.s.redrawTop=a.s.dt.oLoadedState.iScroller-a.s.viewportHeight/2},0)},_fnCalcRowHeight:function(){var a=this.s.dt.nTable.cloneNode(false),b=c('<div class="'+
this.s.dt.oClasses.sWrapper+' DTS"><div class="'+this.s.dt.oClasses.sScrollWrapper+'"><div class="'+this.s.dt.oClasses.sScrollBody+'"></div></div></div>')[0];c(a).append("<tbody><tr><td>&nbsp;</td></tr></tbody>");c("div."+this.s.dt.oClasses.sScrollBody,b).append(a);h.body.appendChild(b);this.s.rowHeight=c("tbody tr",a).outerHeight();h.body.removeChild(b)},_fnInfo:function(){if(this.s.dt.oFeatures.bInfo){var a=this.s.dt,b=this.dom.scroller.scrollTop,d=this.fnPixelsToRow(b)+1,e=a.fnRecordsTotal(),g=
a.fnRecordsDisplay();b=this.fnPixelsToRow(b+c(this.dom.scroller).height());b=g<b?g:b;d=a.fnFormatNumber(d);b=a.fnFormatNumber(b);e=a.fnFormatNumber(e);g=a.fnFormatNumber(g);g=a.fnRecordsDisplay()===0&&a.fnRecordsDisplay()==a.fnRecordsTotal()?a.oLanguage.sInfoEmpty+a.oLanguage.sInfoPostFix:a.fnRecordsDisplay()===0?a.oLanguage.sInfoEmpty+" "+a.oLanguage.sInfoFiltered.replace("_MAX_",e)+a.oLanguage.sInfoPostFix:a.fnRecordsDisplay()==a.fnRecordsTotal()?a.oLanguage.sInfo.replace("_START_",d).replace("_END_",
b).replace("_TOTAL_",g)+a.oLanguage.sInfoPostFix:a.oLanguage.sInfo.replace("_START_",d).replace("_END_",b).replace("_TOTAL_",g)+" "+a.oLanguage.sInfoFiltered.replace("_MAX_",a.fnFormatNumber(a.fnRecordsTotal()))+a.oLanguage.sInfoPostFix;a=a.aanFeatures.i;if(typeof a!="undefined"){e=0;for(d=a.length;e<d;e++)c(a[e]).html(g)}}}};f.oDefaults={trace:false,rowHeight:"auto",serverWait:200,displayBuffer:9,boundaryScale:0.5,loadingIndicator:false};f.prototype.CLASS="Scroller";f.VERSION="1.1.0";f.prototype.VERSION=
f.VERSION;typeof c.fn.dataTable=="function"&&typeof c.fn.dataTableExt.fnVersionCheck=="function"&&c.fn.dataTableExt.fnVersionCheck("1.9.0")?c.fn.dataTableExt.aoFeatures.push({fnInit:function(a){return(new f(a,typeof a.oInit.oScroller=="undefined"?{}:a.oInit.oScroller)).dom.wrapper},cFeature:"S",sFeature:"Scroller"}):alert("Warning: Scroller requires DataTables 1.9.0 or greater - www.datatables.net/download");c.fn.dataTable.Scroller=f})(jQuery,window,document);
